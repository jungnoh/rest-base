# Shop service

쇼핑몰 및 결제에 필요한 모든 기능에 대한 서비스입니다.

## 외부 서비스 의존성
외부 서비스라 함은 `services/shop` 이외의 로컬에 구현된 서비스를 의미합니다.
- `core/iamport`: 아임포트 API 연결 및 응답 파싱


## 서비스 구조
### /order
주문 처리 및 관리에 관한 모든 기능을 구현합니다.
#### /order/index
주문 및 주문 항목 객체의 생성, 조회를 담당합니다.
#### /order/manage
별도의 로직이 필요하지 않으며, 관리자가 임의로 수행할 수 있는 주문 관리를 구현합니다.
주문준비 처리, 배송처리 등의 작업을 수행합니다.
#### /order/payment
주문의 결제 검증, 결제정보 업데이트 등을 수행합니다.
아임포트 결제의 검증, 게좌이체 입금 처리를 합니다.
### /payment
아임포트 API와 주문을 연동합니다.
#### /payment/index
계좌이체에 관한 처리를 수행합니다.
#### /payment/iamport
아임포트의 결제정보 검증 및 웹훅 처리를 수행합니다.

### /products
상품 및 상품 옵션에 대한 모든 기능을 구현합니다.

### /referral
추천인에 관한 모든 기능을 구현합니다.

## 컨트롤러 이용 흐름

1. 주문 생성
`createOrder`으로 주문을 생성합니다. 생성된 주문을 `_id`에 전달하여 아임포트 결제 시 `merchant_uid`에 입력할 수 있도록 합니다.
2. 주문에 결제 연동
아임포트 사용 유무에 따라 `setImpPurchaseId` 또는 `setBankPurchase`으로 주문 정보를 설정합니다. 아임포트의 경우 웹훅으로 먼저 결제 정보를 입력받았을 수 있습니다.
3. 관리자의 배송준비 설정
관리자는 `setPreparing`으로 주문을 배송준비중 상태로 설정합니다.
4. 관리자의 발송완료 설정
관리자는 `setSent`으로 주문을 발송완료 상태로 변경합니다. 필요에 따라 송장번호를 입력합니다.

## 주문 취소
WIP